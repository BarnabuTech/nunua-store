{% extends 'base.html' %}
{% load static %}
{% load humanize %}
{% block title %}Home{% endblock %}
{% block content %}

<!-- üåü Hero Section -->
<section class="relative overflow-hidden bg-gradient-to-br from-orange-500 via-yellow-400 to-blue-600 text-white py-12 px-4 sm:px-6 md:px-10 flex flex-col md:flex-row items-center justify-between min-h-[350px] md:min-h-[420px]">
  <div class="absolute inset-0 bg-black/10 md:bg-black/0"></div>
  <!-- Decorative circles -->
  <div class="absolute top-0 left-0 w-72 h-72 bg-white/10 rounded-full blur-3xl animate-pulse"></div>
  <div class="absolute bottom-0 right-0 w-80 h-80 bg-orange-300/10 rounded-full blur-3xl animate-pulse"></div>

  <div class="relative z-10 md:w-1/2 space-y-6 text-center md:text-left">
    <h1 class="text-5xl md:text-6xl font-extrabold leading-tight drop-shadow-xl">
      Smile, Shop, and Shine with <span class="text-yellow-300">Nunua-store</span>
    </h1>
    <p class="text-lg md:text-xl font-medium text-white/90">
      Discover Africa‚Äôs most trusted and joyful online marketplace‚Äîwhere culture meets commerce.
    </p>
    <div class="flex gap-4 justify-center md:justify-start">
      <a href="{% url 'account_login' %}" class="bg-white text-blue-700 font-bold py-3 px-8 rounded-full shadow-lg hover:bg-blue-50 transition-all duration-200">Explore Now</a>
      <a href="{% url 'account_login' %}" class="bg-yellow-400 text-black font-bold py-3 px-8 rounded-full shadow-lg hover:bg-yellow-300 transition-all duration-200">Start Shopping</a>
    </div>
  </div>

  <div class="relative md:w-1/2 flex justify-center mt-10 md:mt-0">
    <div class="bg-white rounded-3xl p-2 shadow-2xl transform transition hover:scale-105">
      <img src="{% static 'images/hero/hero-image.jpg' %}" alt="Nunua-store Hero" class="w-full max-w-md rounded-2xl object-cover" />
    </div>
  </div>
</section>

<!-- üõçÔ∏è Featured Products Carousel -->
<section class="relative bg-white py-10 sm:py-12 overflow-x-hidden">
  <h2 class="text-2xl sm:text-3xl font-extrabold text-center text-gray-800 mb-6">üî• Trending Now</h2>
  <div class="relative max-w-6xl mx-auto">
    <!-- Responsive Carousel -->
    <div id="carousel" class="flex gap-4 overflow-x-auto snap-x snap-mandatory scrollbar-hide pb-2 sm:pb-0 transition-transform duration-700 ease-in-out">
      {% for product in featured_products %}
      <div class="snap-center min-w-[85vw] sm:min-w-[45vw] md:min-w-[33vw] lg:min-w-[22vw] flex-shrink-0 p-2">
        <div class="bg-gradient-to-br from-yellow-50 to-orange-50 rounded-2xl shadow-md hover:shadow-xl transition-transform hover:scale-105">
          <a href="{{ product.get_absolute_url }}" class="block">
            <img src="{{ product.image.url }}" alt="{{ product.product_name }}" class="w-full h-48 sm:h-56 object-contain rounded-t-2xl">
          </a>
          <div class="p-4 text-center">
            <h3 class="font-semibold text-base sm:text-lg text-gray-900">{{ product.product_name }}</h3>
            <p class="text-indigo-700 font-bold mt-1 text-sm sm:text-base">Ksh {{ product.price|floatformat:2|intcomma }}</p>
            <a href="{{ product.get_absolute_url }}" class="inline-block mt-3 bg-orange-500 hover:bg-orange-600 text-white font-medium py-2 px-4 rounded-full transition-all text-xs sm:text-sm">View</a>
          </div>
        </div>
      </div>
      {% endfor %}
    </div>
    <!-- Nav Buttons (show on sm+) -->
    <button id="prevBtn" class="hidden sm:flex absolute top-1/2 -left-4 transform -translate-y-1/2 bg-orange-500 text-white rounded-full w-10 h-10 items-center justify-center shadow hover:bg-orange-600 z-10">
      &#10094;
    </button>
    <button id="nextBtn" class="hidden sm:flex absolute top-1/2 -right-4 transform -translate-y-1/2 bg-orange-500 text-white rounded-full w-10 h-10 items-center justify-center shadow hover:bg-orange-600 z-10">
      &#10095;
    </button>
  </div>
</section>
<style>
.scrollbar-hide::-webkit-scrollbar{display:none;}
.scrollbar-hide{-ms-overflow-style:none;scrollbar-width:none;}
</style>

<!-- üè∑Ô∏è Category Tabs Filter -->
<section class="w-full bg-gray-50 py-12 px-4 md:px-12">
  <div class="max-w-6xl mx-auto text-center">
    <h2 class="text-3xl font-extrabold text-gray-800 mb-8">üõçÔ∏è Browse by Category</h2>

    <!-- Category Tabs -->
    <div id="categoryTabs" class="flex flex-wrap justify-center gap-3 mb-10">
      <button class="category-tab active-tab bg-orange-500 text-white px-6 py-2 rounded-full font-medium shadow hover:bg-orange-600 transition-all" data-category="all">All</button>
      {% for category in categories %}
      <button class="category-tab bg-white text-gray-700 border border-gray-300 px-6 py-2 rounded-full font-medium shadow hover:bg-orange-100 transition-all" data-category="{{ category.slug }}">{{ category.name }}</button>
      {% endfor %}
    </div>

    <!-- Filtered Products Grid -->
    <div id="filteredProducts" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6">
      {% for product in products %}
      <div class="product-card bg-white rounded-lg shadow hover:shadow-xl transition-transform transform hover:scale-[1.02]" data-category="{{ product.category.slug }}">
        <a href="{{ product.get_absolute_url }}">
          <img src="{{ product.image.url }}" alt="{{ product.product_name }}" class="w-full h-56 object-contain rounded-t-lg">
        </a>
        <div class="p-4 text-left">
          <h3 class="font-semibold text-gray-900 truncate">{{ product.product_name }}</h3>
          <p class="text-indigo-700 font-bold mt-1">Ksh {{ product.price|floatformat:2|intcomma }}</p>
          <a href="{{ product.get_absolute_url }}" class="inline-block mt-3 bg-blue-600 hover:bg-blue-700 text-white py-2 px-4 rounded-full transition-all">View Product</a>
        </div>
      </div>
      {% endfor %}
    </div>
  </div>
</section>


<!-- üåç Why Choose Nunua-store -->
<section class="py-16 px-6 md:px-16 bg-white">
  <div class="max-w-6xl mx-auto flex flex-col md:flex-row gap-12 items-center">
    <div class="flex-1">
      <img src="{% static 'images/hero/about-image.jpg' %}" alt="About Nunua-store" class="rounded-2xl shadow-xl border-4 border-orange-300 animate-fade-in" />
    </div>
    <div class="flex-1 space-y-4">
      <h2 class="text-4xl font-extrabold text-blue-700">Why Choose <span class="text-orange-500">Nunua-store?</span></h2>
      <p class="text-gray-700 text-lg">
        We celebrate African creativity and fairness while making shopping seamless and joyful.
      </p>
      <ul class="grid grid-cols-1 sm:grid-cols-2 gap-4 text-gray-800">
        <li class="flex items-start"><span class="text-orange-500 mr-3 text-2xl">&#10003;</span> Genuine Local Support</li>
        <li class="flex items-start"><span class="text-orange-500 mr-3 text-2xl">&#10003;</span> Transparent Pricing</li>
        <li class="flex items-start"><span class="text-orange-500 mr-3 text-2xl">&#10003;</span> Verified Reviews & Trust</li>
        <li class="flex items-start"><span class="text-orange-500 mr-3 text-2xl">&#10003;</span> Mobile-Friendly Design</li>
        <li class="flex items-start"><span class="text-orange-500 mr-3 text-2xl">&#10003;</span> Fair Trade & Empowerment</li>
      </ul>
    </div>
  </div>
</section>

<!-- üó£Ô∏è Testimonials -->
<section class="py-16 bg-gradient-to-r from-blue-50 via-orange-50 to-yellow-50">
  <div class="max-w-6xl mx-auto px-6">
    <h3 class="text-3xl font-bold text-center text-blue-800 mb-10">What Our Happy Customers Say</h3>

    <div class="grid sm:grid-cols-2 lg:grid-cols-3 gap-8">
      <!-- Customer 1 -->
      <div class="bg-white rounded-xl shadow-lg p-6 text-center hover:shadow-2xl transition">
        <img src="{% static 'images/avatar/woman-2.png' %}" alt="Achieng O" class="w-20 h-20 mx-auto mb-4 rounded-full shadow-md">
        <p class="text-gray-700 italic mb-4">"Nunua-store made me fall in love with online shopping again! Fast, reliable, and full of smiles."</p>
        <h4 class="font-bold text-orange-500">Achieng O.</h4>
        <span class="text-sm text-gray-500">Kisumu, Kenya.</span>
      </div>

      <!-- Customer 2 -->
      <div class="bg-white rounded-xl shadow-lg p-6 text-center hover:shadow-2xl transition">
        <img src="{% static 'images/avatar/man-1.png' %}" alt="Brian K" class="w-20 h-20 mx-auto mb-4 rounded-full shadow-md">
        <p class="text-gray-700 italic mb-4">"Shopping on my phone has never been this smooth. Nunua-store is the future!"</p>
        <h4 class="font-bold text-orange-500">Brian K.</h4>
        <span class="text-sm text-gray-500">Nairobi, Kenya.</span>
      </div>

      <!-- Customer 3 -->
      <div class="bg-white rounded-xl shadow-lg p-6 text-center hover:shadow-2xl transition">
        <img src="{% static 'images/avatar/woman-1.png' %}" alt="Fatma S" class="w-20 h-20 mx-auto mb-4 rounded-full shadow-md">
        <p class="text-gray-700 italic mb-4">"I love how transparent and trustworthy Nunua-store feels. Proudly African!"</p>
        <h4 class="font-bold text-orange-500">Fatma S.</h4>
        <span class="text-sm text-gray-500">Mombasa, Kenya.</span>
      </div>
    </div>
  </div>
</section>

<!-- üõçÔ∏è Product Grid -->
<div class="container mx-auto px-6 py-16">
  <h3 class="text-3xl font-extrabold text-gray-800 mb-8 text-center">Featured Products</h3>
  <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-8">
    {% if products %}
      {% for product in products %}
      <div class="relative bg-white rounded-2xl shadow-md hover:shadow-xl transition-all overflow-hidden group">
        <button class="absolute top-3 right-3 bg-white p-2 rounded-full shadow hover:bg-red-100 transition wishlist-btn" data-product-id="{{product.id}}" {% if product.id in wishlisted_ids %}data-wishlisted="true"{% else %}data-wishlisted="false"{% endif %}>
          <svg class="w-6 h-6 heart-icon {% if product.id in wishlisted_ids %}text-red-600{% else %}text-gray-500{% endif %}" {% if product.id in wishlisted_ids %}fill="currentColor"{% else %}fill="none"{% endif %} stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z"/>
          </svg>
        </button>

        <a href="{{ product.get_absolute_url }}" class="block">
          <img src="{{ product.image.url }}" alt="{{ product.product_name }}" class="w-full h-60 object-contain p-4 group-hover:scale-105 transition-transform duration-300">
        </a>

        <div class="p-4 border-t">
          <h4 class="font-semibold text-gray-900 truncate">{{ product.product_name }}</h4>
          <div class="flex justify-between items-center mt-2">
            <span class="text-indigo-600 font-bold">Ksh {{ product.price|floatformat:2|intcomma }}</span>
            <span class="text-sm bg-gray-100 text-gray-600 px-2 py-1 rounded">{{ product.stock|default:0 }} left</span>
          </div>
        </div>
      </div>
      {% endfor %}
    {% else %}
      <p class="col-span-full text-center text-gray-500">No products found</p>
    {% endif %}
  </div>
</div>

<script>
const tabs = document.querySelectorAll('.category-tab');
const cards = document.querySelectorAll('.product-card');

tabs.forEach(tab => {
  tab.addEventListener('click', () => {
    tabs.forEach(t => t.classList.remove('active-tab', 'bg-orange-500', 'text-white'));
    tab.classList.add('active-tab', 'bg-orange-500', 'text-white');

    const category = tab.getAttribute('data-category');
    cards.forEach(card => {
      card.style.display = category === 'all' || card.dataset.category === category ? 'block' : 'none';
    });
  });
});

const carousel = document.getElementById("carousel");
const nextBtn = document.getElementById("nextBtn");
const prevBtn = document.getElementById("prevBtn");
let index = 0;

function slideCarousel() {
  const total = carousel.children.length;
  index = (index + 1) % total;
  carousel.style.transform = `translateX(-${index * 100}%)`;
}

let autoSlide = setInterval(slideCarousel, 4000);

nextBtn.addEventListener("click", () => {
  clearInterval(autoSlide);
  slideCarousel();
  autoSlide = setInterval(slideCarousel, 4000);
});

prevBtn.addEventListener("click", () => {
  clearInterval(autoSlide);
  index = (index - 1 + carousel.children.length) % carousel.children.length;
  carousel.style.transform = `translateX(-${index * 100}%)`;
  autoSlide = setInterval(slideCarousel, 4000);
});
  
document.querySelectorAll('.wishlist-btn').forEach(btn => {
  btn.addEventListener('click', function(e) {
    e.preventDefault();
    const productId = this.getAttribute('data-product-id');
    const isWishlisted = this.getAttribute('data-wishlisted') === 'true';
    const userIsAuthenticated = {{ request.user.is_authenticated|yesno:'true,false' }};
    if (!userIsAuthenticated) {
      window.location.href = '{% url "account_login" %}?next=' + window.location.pathname;
      return;
    }
    const url = isWishlisted ? '{% url "remove_from_wishlist" %}' : '{% url "add_to_wishlist" %}';
    fetch(url, {
      method: 'POST',
      headers: {
        'X-CSRFToken': '{{ csrf_token }}',
        'Content-Type': 'application/x-www-form-urlencoded',
      },
      body: `product_id=${productId}`
    }).then(res => res.json()).then(data => {
      if (data.status === 'added') {
        this.setAttribute('data-wishlisted', 'true');
        this.querySelector('.heart-icon').classList.replace('text-gray-500', 'text-red-600');
        this.querySelector('.heart-icon').setAttribute('fill', 'currentColor');
      } else if (data.status === 'removed') {
        this.setAttribute('data-wishlisted', 'false');
        this.querySelector('.heart-icon').classList.replace('text-red-600', 'text-gray-500');
        this.querySelector('.heart-icon').setAttribute('fill', 'none');
      }
    });
  });
});
</script>

{% endblock %}
